<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë° - ìŠ¤ë§ˆíŠ¸ ì¶œí‡´ê·¼ ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'kakao-yellow': '#fef01b',
                        'kakao-bg': '#9bbbd4',
                        'kakao-text': '#556677',
                        'kakao-chat-bg': '#b2c7da'
                    },
                    fontFamily: {
                        'kakao': ['Apple SD Gothic Neo', 'Malgun Gothic', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background: linear-gradient(to bottom, #b2c7da, #9bbbd4);
        }

        .message-bubble {
            max-width: 75%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
        }

        .message-other {
            background: white;
            border-radius: 18px 18px 18px 4px;
        }

        .message-user {
            background: #fef01b;
            border-radius: 18px 18px 4px 18px;
            margin-left: auto;
        }

        .message-system {
            background: #f0f8ff;
            border: 1px solid #e0f0ff;
            border-radius: 12px;
            margin: 8px auto;
            max-width: 90%;
        }

        .typing-indicator {
            animation: pulse 1.5s infinite;
        }

        .route-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #e0e0e0;
            margin: 8px 0;
            overflow: hidden;
        }

        .urgent-message {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            animation: urgentPulse 2s infinite;
        }

        .time-picker {
            background: white;
            border-radius: 16px;
            border: 1px solid #e0e0e0;
            margin: 8px 0;
            padding: 16px;
            max-width: 280px;
        }

        .time-display {
            font-size: 24px;
            font-weight: bold;
            text-align: center;
            color: #333;
            margin: 16px 0;
        }

        .time-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
        }

        .time-button {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }

        .time-button:hover {
            background: #e0e0e0;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        @keyframes urgentPulse {
            0%, 100% {
                border-color: #fed7d7;
            }
            50% {
                border-color: #fc8181;
            }
        }

        .button-action {
            background: #f0f0f0;
            border: 1px solid #ddd;
            border-radius: 20px;
            padding: 8px 16px;
            margin: 4px 2px;
            display: inline-block;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .button-action:hover {
            background: #e0e0e0;
        }

        .button-primary {
            background: #fef01b;
            border: 1px solid #e6d600;
        }

        .button-primary:hover {
            background: #e6d600;
        }

        .button-urgent {
            background: #ff6b6b;
            color: white;
            border: 1px solid #ff5252;
        }

        .button-urgent:hover {
            background: #ff5252;
        }

        .time-badge {
            background: #e8f5e8;
            color: #2d5a2d;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .notification-sound {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fef01b;
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            animation: notificationPop 0.5s ease-out;
            z-index: 1000;
        }

        @keyframes notificationPop {
            0% {
                transform: translateY(-20px) scale(0.8);
                opacity: 0;
            }
            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- ì•Œë¦¼ ì‚¬ìš´ë“œ í‘œì‹œ -->
    <div id="notification-sound" class="notification-sound hidden">
        ğŸ”” ì¹´ë° ì•Œë¦¼
    </div>

    <!-- ì¹´ì¹´ì˜¤í†¡ í—¤ë” -->
    <div class="bg-kakao-yellow shadow-sm">
        <div class="max-w-md mx-auto px-4 py-3 flex items-center">
            <button onclick="goBack()" class="mr-3 text-gray-700">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
            </button>
            <div class="flex items-center space-x-3 flex-1">
                <div class="w-10 h-10 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center">
                    <span class="text-white text-lg">ğŸ¤–</span>
                </div>
                <div>
                    <h1 class="font-semibold text-gray-800">ì¹´ë°</h1>
                    <p class="text-xs text-gray-600" id="calming-status">ì¶œí‡´ê·¼ ê´€ë¦¬ ë¹„ì„œ</p>
                </div>
            </div>
            <div class="flex space-x-2">
                <button onclick="showTimeSimulator()" class="text-gray-700 text-xs bg-white bg-opacity-50 px-2 py-1 rounded">
                    â° ì‹œê°„
                </button>
                <button class="text-gray-700">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ì±„íŒ… ì˜ì—­ -->
    <div class="max-w-md mx-auto bg-kakao-chat-bg min-h-screen">
        <div id="chat-container" class="p-4 space-y-3 pb-20">
            <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë©ë‹ˆë‹¤ -->
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t p-3">
            <div class="flex items-center space-x-2">
                <button class="text-gray-500">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                </button>
                <input id="message-input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" 
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-full focus:outline-none focus:border-kakao-yellow"
                    onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()" class="bg-kakao-yellow text-gray-800 px-4 py-2 rounded-full font-medium hover:bg-yellow-500 transition-colors">
                    ì „ì†¡
                </button>
            </div>
        </div>
    </div>

    <!-- ì‹œê°„ ì‹œë®¬ë ˆì´í„° ëª¨ë‹¬ -->
    <div id="time-simulator" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 w-80">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜</h3>
            <div class="space-y-3">
                <button onclick="simulateTime('06:50', 'morning')" class="w-full bg-blue-100 text-blue-800 py-3 px-4 rounded-xl font-medium hover:bg-blue-200 transition-colors">
                    ğŸŒ… 06:50 - ëª¨ë‹ ë¸Œë¦¬í•‘
                </button>
                <button onclick="simulateTime('08:08', 'departure')" class="w-full bg-green-100 text-green-800 py-3 px-4 rounded-xl font-medium hover:bg-green-200 transition-colors">
                    ğŸš€ 08:08 - ì¶œë°œ ì•Œë¦¼
                </button>
                <button onclick="simulateTime('07:45', 'exception')" class="w-full bg-red-100 text-red-800 py-3 px-4 rounded-xl font-medium hover:bg-red-200 transition-colors">
                    ğŸš¨ 07:45 - ì§€í•˜ì²  ì§€ì—°
                </button>
                <button onclick="simulateTime('07:30', 'weather')" class="w-full bg-orange-100 text-orange-800 py-3 px-4 rounded-xl font-medium hover:bg-orange-200 transition-colors">
                    ğŸŒ§ï¸ 07:30 - ë‚ ì”¨ ê¸´ê¸‰ìƒí™©
                </button>
                <button onclick="simulateTime('17:30', 'evening')" class="w-full bg-purple-100 text-purple-800 py-3 px-4 rounded-xl font-medium hover:bg-purple-200 transition-colors">
                    ğŸŒ† 17:30 - í‡´ê·¼ ì•Œë¦¼
                </button>
            </div>
            <button onclick="closeTimeSimulator()" class="w-full mt-4 bg-gray-200 text-gray-700 py-2 px-4 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                ë‹«ê¸°
            </button>
        </div>
    </div>

    <script>
        let chatContainer = document.getElementById('chat-container');
        let messageInput = document.getElementById('message-input');
        let currentStep = 0;
        let isOnboarded = false;
        let userProfile = {
            name: '',
            homeAddress: '',
            workAddress: '',
            arrivalTime: { hour: 9, minute: 0, period: 'AM' },
            allowTracking: false
        };

        // ì•Œë¦¼ ì‚¬ìš´ë“œ í‘œì‹œ
        function showNotificationSound() {
            const soundDiv = document.getElementById('notification-sound');
            soundDiv.classList.remove('hidden');
            setTimeout(() => {
                soundDiv.classList.add('hidden');
            }, 2000);
        }

        // ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
        function addMessage(content, isUser = false, hasButtons = false, buttons = [], isUrgent = false, isSystem = false) {
            const messageDiv = document.createElement('div');
            let className = `message-bubble p-3 mb-2`;
            
            if (isSystem) {
                className += ' message-system';
            } else if (isUser) {
                className += ' message-user ml-auto';
            } else {
                className += ` message-other ${isUrgent ? 'urgent-message' : ''}`;
            }
            
            messageDiv.className = className;
            
            let messageHTML = `<p class="text-sm ${isSystem ? 'text-blue-800 text-center' : 'text-gray-800'}">${content}</p>`;
            
            if (hasButtons && buttons.length > 0) {
                messageHTML += '<div class="mt-3 space-y-1">';
                buttons.forEach(button => {
                    let buttonClass = 'button-action text-sm';
                    if (button.urgent) buttonClass = 'button-urgent text-sm';
                    else if (button.primary) buttonClass = 'button-primary text-sm';
                    
                    messageHTML += `<button onclick="${button.action}" class="${buttonClass}">${button.text}</button>`;
                });
                messageHTML += '</div>';
            }
            
            messageDiv.innerHTML = messageHTML;
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // ì‹œê°„ ì„ íƒê¸° ì¶”ê°€
        function addTimePicker() {
            const timePickerDiv = document.createElement('div');
            timePickerDiv.className = 'time-picker';
            timePickerDiv.id = 'time-picker';
            
            const timeDisplay = formatTime(userProfile.arrivalTime);
            
            timePickerDiv.innerHTML = `
                <h4 class="font-semibold text-gray-800 mb-3 text-center">íšŒì‚¬ ë„ì°© í¬ë§ ì‹œê°„</h4>
                <div class="time-display" id="time-display">${timeDisplay}</div>
                
                <div class="time-controls">
                    <span class="text-sm text-gray-600">ì‹œê°„</span>
                    <div class="flex items-center space-x-2">
                        <button class="time-button" onclick="adjustTime('hour', -1)">âˆ’</button>
                        <span class="w-8 text-center font-semibold" id="hour-display">${userProfile.arrivalTime.hour}</span>
                        <button class="time-button" onclick="adjustTime('hour', 1)">+</button>
                    </div>
                </div>
                
                <div class="time-controls">
                    <span class="text-sm text-gray-600">ë¶„</span>
                    <div class="flex items-center space-x-2">
                        <button class="time-button" onclick="adjustTime('minute', -15)">âˆ’</button>
                        <span class="w-8 text-center font-semibold" id="minute-display">${userProfile.arrivalTime.minute.toString().padStart(2, '0')}</span>
                        <button class="time-button" onclick="adjustTime('minute', 15)">+</button>
                    </div>
                </div>
                
                <div class="time-controls">
                    <span class="text-sm text-gray-600">ì˜¤ì „/ì˜¤í›„</span>
                    <div class="flex items-center space-x-2">
                        <button class="time-button" onclick="togglePeriod()" style="width: auto; padding: 8px 16px; border-radius: 20px;">
                            <span id="period-display">${userProfile.arrivalTime.period}</span>
                        </button>
                    </div>
                </div>
                
                <button onclick="confirmArrivalTime()" class="w-full mt-4 bg-kakao-yellow text-gray-800 py-2 px-4 rounded-xl font-medium hover:bg-yellow-500 transition-colors">
                    âœ… ì‹œê°„ í™•ì •
                </button>
            `;
            
            chatContainer.appendChild(timePickerDiv);
            scrollToBottom();
        }

        // ì‹œê°„ í¬ë§·íŒ…
        function formatTime(timeObj) {
            const hour = timeObj.hour;
            const minute = timeObj.minute.toString().padStart(2, '0');
            const period = timeObj.period;
            return `${hour}:${minute} ${period}`;
        }

        // ì‹œê°„ ì¡°ì •
        function adjustTime(type, delta) {
            if (type === 'hour') {
                userProfile.arrivalTime.hour += delta;
                if (userProfile.arrivalTime.hour > 12) userProfile.arrivalTime.hour = 1;
                if (userProfile.arrivalTime.hour < 1) userProfile.arrivalTime.hour = 12;
            } else if (type === 'minute') {
                userProfile.arrivalTime.minute += delta;
                if (userProfile.arrivalTime.minute >= 60) userProfile.arrivalTime.minute = 0;
                if (userProfile.arrivalTime.minute < 0) userProfile.arrivalTime.minute = 45;
            }
            
            updateTimeDisplay();
        }

        // ì˜¤ì „/ì˜¤í›„ í† ê¸€
        function togglePeriod() {
            userProfile.arrivalTime.period = userProfile.arrivalTime.period === 'AM' ? 'PM' : 'AM';
            updateTimeDisplay();
        }

        // ì‹œê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateTimeDisplay() {
            document.getElementById('time-display').textContent = formatTime(userProfile.arrivalTime);
            document.getElementById('hour-display').textContent = userProfile.arrivalTime.hour;
            document.getElementById('minute-display').textContent = userProfile.arrivalTime.minute.toString().padStart(2, '0');
            document.getElementById('period-display').textContent = userProfile.arrivalTime.period;
        }

        // ë„ì°© ì‹œê°„ í™•ì •
        function confirmArrivalTime() {
            const timeString = formatTime(userProfile.arrivalTime);
            addMessage(`ë„ì°© í¬ë§ ì‹œê°„: ${timeString}`, true);
            
            // ì‹œê°„ ì„ íƒê¸° ì œê±°
            const timePicker = document.getElementById('time-picker');
            if (timePicker) timePicker.remove();
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('ì™„ë²½í•´ìš”! ë§ˆì§€ë§‰ìœ¼ë¡œ ë” ì •í™•í•œ ì¶”ì²œì„ ìœ„í•´ ì´ë™ íŒ¨í„´ í•™ìŠµì— ë™ì˜í•´ì£¼ì‹œê² ì–´ìš”?', false, true, [
                        { text: 'ğŸ“‹ ìì„¸í•œ ë‚´ìš© ë³´ê¸°', action: 'showPrivacyDetails()', primary: false },
                        { text: 'ë„¤, ë™ì˜í•´ìš”', action: 'allowTracking(true)', primary: false },
                        { text: 'ì•„ë‹ˆìš”, ê´œì°®ì•„ìš”', action: 'allowTracking(false)', primary: false }
                    ]);
                }, 1500);
            }, 500);
        }

        // ê²½ë¡œ ì¹´ë“œ ì¶”ê°€
        function addRouteCard(routes, title = "ì¶”ì²œ ê²½ë¡œ") {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'route-card p-4 mb-2 max-w-xs';
            
            let cardHTML = `<h4 class="font-semibold text-gray-800 mb-3">${title}</h4>`;
            
            routes.forEach((route, index) => {
                const statusColor = route.status === 'ì›í™œ' ? 'text-green-600' : 
                                  route.status === 'ì§€ì—°' ? 'text-red-600' : 'text-orange-600';
                
                cardHTML += `
                    <div class="flex items-center justify-between p-3 ${index > 0 ? 'border-t border-gray-100' : ''} ${route.recommended ? 'bg-yellow-50 rounded-lg' : ''}">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 ${route.color} rounded-full flex items-center justify-center">
                                <span class="text-white text-xs font-bold">${route.icon}</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 text-sm">${route.name}</p>
                                <p class="text-xs text-gray-600">${route.description}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm font-semibold text-gray-800">${route.time}</div>
                            <div class="text-xs ${statusColor}">${route.status}</div>
                        </div>
                    </div>
                `;
            });
            
            cardHTML += `
                <button onclick="startNavigation()" class="w-full mt-3 bg-kakao-yellow text-gray-800 py-2 px-4 rounded-xl font-medium hover:bg-yellow-500 transition-colors">
                    ğŸ—ºï¸ ê²½ë¡œ ì•ˆë‚´ ì‹œì‘
                </button>
            `;
            
            cardDiv.innerHTML = cardHTML;
            chatContainer.appendChild(cardDiv);
            scrollToBottom();
        }

        // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'message-bubble message-other p-3 mb-2 typing-indicator';
            typingDiv.innerHTML = '<p class="text-sm text-gray-600">ì¹´ë°ì´ ì…ë ¥ ì¤‘...</p>';
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        // ìŠ¤í¬ë¡¤ í•˜ë‹¨ìœ¼ë¡œ
        function scrollToBottom() {
            setTimeout(() => {
                window.scrollTo(0, document.body.scrollHeight);
            }, 100);
        }

        // í‚¤ ì…ë ¥ ì²˜ë¦¬
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            messageInput.value = '';
            
            setTimeout(() => {
                handleCalmingResponse(message);
            }, 1000);
        }

        // ì¹´ë° ì‘ë‹µ ì²˜ë¦¬
        function handleCalmingResponse(userMessage) {
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                
                if (!isOnboarded && (userMessage.includes('ì¶œí‡´ê·¼') || userMessage.includes('ì¹´ë°'))) {
                    startOnboarding();
                } else if (isOnboarded) {
                    handleOnboardedResponse(userMessage);
                } else {
                    addMessage('ì•ˆë…•í•˜ì„¸ìš”! ì¶œí‡´ê·¼ ê´€ë¦¬ê°€ í•„ìš”í•˜ì‹œë©´ "ì¶œí‡´ê·¼ ì•Œë ¤ì¤˜"ë¼ê³  ë§ì”€í•´ì£¼ì„¸ìš”! ğŸ˜Š');
                }
            }, 2000);
        }

        // ì˜¨ë³´ë”© ì™„ë£Œ í›„ ì‘ë‹µ
        function handleOnboardedResponse(message) {
            if (message.includes('ì•Œë¦¼') || message.includes('ë¸Œë¦¬í•‘')) {
                addMessage('ì–´ë–¤ ì•Œë¦¼ì„ í™•ì¸í•´ë³´ì‹œê² ì–´ìš”?', false, true, [
                    { text: 'ğŸŒ… ëª¨ë‹ ë¸Œë¦¬í•‘', action: 'sendMorningBriefing()', primary: false },
                    { text: 'ğŸš€ ì¶œë°œ ì•Œë¦¼', action: 'sendDepartureAlert()', primary: false },
                    { text: 'ğŸš¨ ê¸´ê¸‰ ì•Œë¦¼', action: 'sendExceptionAlert()', primary: false }
                ]);
            } else if (message.includes('ê²½ë¡œ') || message.includes('ê¸¸')) {
                addMessage('í˜„ì¬ êµí†µ ìƒí™©ì„ í™•ì¸í•´ë“œë¦´ê²Œìš”!', false);
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2í˜¸ì„  + ë„ë³´',
                            description: 'ê°•ë‚¨ì—­ â†’ íšŒì‚¬',
                            time: '42ë¶„',
                            status: 'ì›í™œ',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        },
                        {
                            name: '740ë²ˆ ë²„ìŠ¤',
                            description: 'ì§í–‰',
                            time: '48ë¶„',
                            status: 'ë³´í†µ',
                            color: 'bg-green-500',
                            icon: 'ğŸšŒ'
                        }
                    ];
                    addRouteCard(routes);
                }, 1000);
            } else {
                addMessage('ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ğŸ˜Š', false, true, [
                    { text: 'ğŸ“ í˜„ì¬ ê²½ë¡œ í™•ì¸', action: 'checkCurrentRoute()', primary: false },
                    { text: 'â° ì•Œë¦¼ ì„¤ì •', action: 'showNotificationSettings()', primary: false },
                    { text: 'ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µ ì—´ê¸°', action: 'openKakaoMap()', primary: false }
                ]);
            }
        }

        // ì˜¨ë³´ë”© ì‹œì‘
        function startOnboarding() {
            addMessage(`ì•ˆë…•í•˜ì„¸ìš”! ë§¤ì¼ ì•„ì¹¨ ì¶œê·¼ê¸¸ì„ ì±™ê²¨ë“œë¦¬ëŠ” ë¹„ì„œ, ì¹´ë°ì´ì—ìš”. ğŸ˜Š<br><br>ë¨¼ì € ì¶œí‡´ê·¼ í”„ë¡œí•„ì„ ë§Œë“¤ì–´ë³¼ê¹Œìš”?<br><br>ì§‘ ì£¼ì†Œë¥¼ ì•Œë ¤ì£¼ì‹œê² ì–´ìš”?`, false, true, [
                { text: 'ğŸ  ì£¼ì†Œ ê²€ìƒ‰', action: 'searchHomeAddress()', primary: false }
            ]);
        }

        // ì£¼ì†Œ ê²€ìƒ‰ (ê°„ë‹¨í•œ ë²„ì „)
        function searchHomeAddress() {
            const addresses = [
                'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
                'ì„œìš¸ì‹œ ì„œì´ˆêµ¬ ì„œì´ˆëŒ€ë¡œ 456', 
                'ì„œìš¸ì‹œ ì†¡íŒŒêµ¬ ì˜¬ë¦¼í”½ë¡œ 789',
                'ì„œìš¸ì‹œ ë§ˆí¬êµ¬ ì›”ë“œì»µë¶ë¡œ 321'
            ];
            
            const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
            userProfile.homeAddress = randomAddress;
            
            setTimeout(() => {
                addMessage(`ì§‘ ì£¼ì†Œ: ${randomAddress}`, true);
                
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        addMessage('ì¢‹ì•„ìš”! ì´ì œ íšŒì‚¬ ì£¼ì†Œë„ ì•Œë ¤ì£¼ì„¸ìš”.', false, true, [
                            { text: 'ğŸ¢ ì£¼ì†Œ ê²€ìƒ‰', action: 'searchWorkAddress()', primary: false }
                        ]);
                    }, 1500);
                }, 500);
            }, 1000);
        }

        function searchWorkAddress() {
            const addresses = [
                'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ ì—­ì‚¼ë¡œ 456',
                'ì„œìš¸ì‹œ ì„œì´ˆêµ¬ ê°•ë‚¨ëŒ€ë¡œ 789', 
                'ì„œìš¸ì‹œ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ 123'
            ];
            
            const randomAddress = addresses[Math.floor(Math.random() * addresses.length)];
            userProfile.workAddress = randomAddress;
            
            setTimeout(() => {
                addMessage(`íšŒì‚¬ ì£¼ì†Œ: ${randomAddress}`, true);
                
                setTimeout(() => {
                    showTyping();
                    setTimeout(() => {
                        hideTyping();
                        addMessage('ì™„ë²½í•´ìš”! ë§ˆì§€ë§‰ìœ¼ë¡œ íšŒì‚¬ ë„ì°© í¬ë§ ì‹œê°„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                        
                        setTimeout(() => {
                            addTimePicker();
                        }, 1000);
                    }, 1500);
                }, 500);
            }, 1000);
        }

        // ê°œì¸ì •ë³´ ìƒì„¸ ì„¤ëª…
        function showPrivacyDetails() {
            addMessage('ìì„¸í•œ ë‚´ìš©ì„ ì•Œë ¤ì£¼ì„¸ìš”', true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('ğŸ”’ ê°œì¸ì •ë³´ ì²˜ë¦¬ ë°©ì¹¨<br><br><strong>ìˆ˜ì§‘í•˜ëŠ” ì •ë³´:</strong><br>â€¢ ì¶œë°œ/ë„ì°© ì‹œê°„ ê¸°ë¡<br>â€¢ ì´ìš© êµí†µìˆ˜ë‹¨ (ì§€í•˜ì² /ë²„ìŠ¤/ë„ë³´)<br>â€¢ ê²½ë¡œ ì„ íƒ íŒ¨í„´<br><br><strong>ì‚¬ìš© ëª©ì :</strong><br>â€¢ ê°œì¸ ë§ì¶¤ ì¶œë°œ ì‹œê°„ ì¶”ì²œ<br>â€¢ êµí†µ ìƒí™© ì˜ˆì¸¡ ì •í™•ë„ í–¥ìƒ<br>â€¢ ë‚ ì”¨ë³„ ì´ë™ íŒ¨í„´ ë¶„ì„<br><br><strong>ë³´ê´€ ë° ë³´í˜¸:</strong><br>â€¢ ìµœê·¼ 30ì¼ê°„ë§Œ ë³´ê´€<br>â€¢ ì•”í˜¸í™”í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì €ì¥<br>â€¢ ì™¸ë¶€ ì œê³µ ì ˆëŒ€ ê¸ˆì§€<br>â€¢ ì–¸ì œë“  ì‚­ì œ ìš”ì²­ ê°€ëŠ¥', false, true, [
                        { text: 'ë™ì˜í•˜ê³  ì‹œì‘í•˜ê¸°', action: 'allowTracking(true)', primary: false },
                        { text: 'í•™ìŠµ ì—†ì´ ì‚¬ìš©í•˜ê¸°', action: 'allowTracking(false)', primary: false }
                    ]);
                }, 2500);
            }, 500);
        }

        // íŒ¨í„´ í•™ìŠµ ë™ì˜ (ê°œì¸ì •ë³´ ì„¤ëª… í¬í•¨)
        function allowTracking(allow) {
            userProfile.allowTracking = allow;
            addMessage(allow ? 'ë™ì˜í•˜ê³  ì‹œì‘í•˜ê¸°' : 'í•™ìŠµ ì—†ì´ ì‚¬ìš©í•˜ê¸°', true);
            
            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    
                    if (allow) {
                        addMessage('ğŸ”’ ê°œì¸ì •ë³´ ë³´í˜¸ ì•ˆë‚´<br><br>â€¢ ìˆ˜ì§‘ ì •ë³´: ì¶œë°œ/ë„ì°© ì‹œê°„, ì´ìš© êµí†µìˆ˜ë‹¨<br>â€¢ ë³´ê´€ ê¸°ê°„: ìµœê·¼ 30ì¼ê°„<br>â€¢ ì‚¬ìš© ëª©ì : ê°œì¸ ë§ì¶¤ ê²½ë¡œ ì¶”ì²œ<br>â€¢ ì™¸ë¶€ ì œê³µ: ì ˆëŒ€ í•˜ì§€ ì•ŠìŒ<br><br>ì–¸ì œë“  ì„¤ì •ì—ì„œ í•™ìŠµì„ ì¤‘ë‹¨í•  ìˆ˜ ìˆì–´ìš”.', false, false, [], false, true);
                        
                        setTimeout(() => {
                            completeOnboarding();
                        }, 3000);
                    } else {
                        completeOnboarding();
                    }
                }, 2000);
            }, 500);
        }

        // ì˜¨ë³´ë”© ì™„ë£Œ
        function completeOnboarding() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                isOnboarded = true;
                addMessage('âœ… ë©‹ì§„ ì¶œí‡´ê·¼ í”„ë¡œí•„ì´ ì™„ì„±ë˜ì—ˆì–´ìš”!<br><br>ì´ì œë¶€í„° ì œê°€ ë§¤ì¼ ì•„ì¹¨ ì±™ê²¨ë“œë¦´ê²Œìš”.<br><br>ìƒë‹¨ì˜ â° ì‹œê°„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ ë‹¤ì–‘í•œ ì‹œê°„ëŒ€ì˜ ì•Œë¦¼ì„ ì²´í—˜í•´ë³´ì„¸ìš”!', false, true, [
                    { text: 'â° ì•Œë¦¼ ì²´í—˜í•˜ê¸°', action: 'showTimeSimulator()', primary: false },
                    { text: 'ğŸ—ºï¸ ì¹´ì¹´ì˜¤ë§µ ì—´ê¸°', action: 'openKakaoMap()', primary: false }
                ]);
                
                // ìƒíƒœ ì—…ë°ì´íŠ¸
                document.getElementById('calming-status').textContent = 'í™œì„±í™”ë¨ â€¢ ì¶œí‡´ê·¼ ê´€ë¦¬ ì¤‘';
            }, 1500);
        }

        // ì‹œê°„ ì‹œë®¬ë ˆì´í„° í‘œì‹œ
        function showTimeSimulator() {
            document.getElementById('time-simulator').classList.remove('hidden');
        }

        function closeTimeSimulator() {
            document.getElementById('time-simulator').classList.add('hidden');
        }

        // ì‹œê°„ë³„ ì•Œë¦¼ ì‹œë®¬ë ˆì´ì…˜
        function simulateTime(time, type) {
            closeTimeSimulator();
            showNotificationSound();
            
            addMessage(`â° ì‹œê°„: ${time}`, false, false, [], false, true);
            
            setTimeout(() => {
                if (type === 'morning') {
                    sendMorningBriefing();
                } else if (type === 'departure') {
                    sendDepartureAlert();
                } else if (type === 'exception') {
                    sendExceptionAlert();
                } else if (type === 'weather') {
                    sendWeatherAlert();
                } else if (type === 'evening') {
                    sendEveningAlert();
                }
            }, 1000);
        }

        // ëª¨ë‹ ë¸Œë¦¬í•‘
        function sendMorningBriefing() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                const timeString = formatTime(userProfile.arrivalTime);
                addMessage(`â˜€ï¸ ì¢‹ì€ ì•„ì¹¨!<br><br>ì˜¤ëŠ˜ ì¶œê·¼ê¸¸ì€ ëŒ€ì²´ë¡œ ë§‘ê³ , êµí†µë„ ì›í™œí•´ìš”.<br><br>íšŒì‚¬ê¹Œì§€ ì•½ 45ë¶„ ì˜ˆìƒë©ë‹ˆë‹¤.<br><br>${timeString} ì •ì‹œ ë„ì°©ì„ ìœ„í•´ 08:15ì— ì¶œë°œí•˜ì‹œëŠ” ê±¸ ì¶”ì²œí•´ìš”!`);
                
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2í˜¸ì„  + ë„ë³´',
                            description: 'ê°•ë‚¨ì—­ â†’ íšŒì‚¬',
                            time: '45ë¶„',
                            status: 'ì›í™œ',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        }
                    ];
                    addRouteCard(routes, "ì˜¤ëŠ˜ì˜ ì¶”ì²œ ê²½ë¡œ");
                }, 1000);
            }, 2000);
        }

        // ì¶œë°œ ì•Œë¦¼
        function sendDepartureAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('ğŸš€ ì§€ê¸ˆ ë°”ë¡œ ì¶œë°œí•˜ì„¸ìš”!<br><br>ì˜¤ëŠ˜ë„ í˜ë‚´ì„¸ìš”!', false, false, [], false);
                
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2í˜¸ì„  + ë„ë³´',
                            description: 'ê°•ë‚¨ì—­ â†’ íšŒì‚¬',
                            time: '42ë¶„',
                            status: 'ì›í™œ',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        }
                    ];
                    addRouteCard(routes, "ì§€ê¸ˆ ì¶œë°œ ê²½ë¡œ");
                }, 1000);
            }, 1500);
        }

        // ì˜ˆì™¸ ìƒí™© ì•Œë¦¼
        function sendExceptionAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('ğŸš¨ <strong>ê¸´ê¸‰ ìƒí™©!</strong><br><br>2í˜¸ì„ ì— ì‹ í˜¸ ì¥ì• ê°€ ë°œìƒí–ˆì–´ìš”. 15ë¶„ ì§€ì—°ì´ ì˜ˆìƒë©ë‹ˆë‹¤.<br><br>ëŒ€ì•ˆ ê²½ë¡œë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”!', false, false, [], true);
                
                setTimeout(() => {
                    addMessage('ğŸ”„ ëŒ€ì•ˆ ê²½ë¡œ ì•ˆë‚´<br><br>â€¢ 3í˜¸ì„  í™˜ìŠ¹ ê²½ë¡œ: 35ë¶„<br>â€¢ ë²„ìŠ¤ 740ë²ˆ: 40ë¶„<br>â€¢ íƒì‹œ ì´ìš©: 25ë¶„ (8,000ì›)', false, true, [
                        { text: 'ğŸš‡ ì§€í•˜ì²  ê²½ë¡œë¡œ ë³€ê²½', action: 'useAlternativeRoute()', primary: false },
                        { text: 'ğŸŒ‚ ìš°ì‚° ì±™ê¸°ê¸° ì•Œë¦¼', action: 'setUmbrellaReminder()', primary: false }
                    ]);
                }, 2000);
            }, 1500);
        }

        // ë‚ ì”¨ ì•Œë¦¼
        function sendWeatherAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('ğŸŒ§ï¸ <strong>ë‚ ì”¨ ì•Œë¦¼!</strong><br><br>30ë¶„ ë’¤ë¶€í„° ë¹„ê°€ ì˜¬ ì˜ˆì •ì´ì—ìš”.<br><br>ìš°ì‚°ì„ ì±™ê¸°ì‹œê³  í‰ì†Œë³´ë‹¤ 5ë¶„ ì¼ì° ì¶œë°œí•˜ì„¸ìš”!', false, false, [], false);
                
                setTimeout(() => {
                    addMessage('â˜” ë¹„ ëŒ€ë¹„ ì¶”ì²œ<br><br>â€¢ ìš°ì‚° ì±™ê¸°ê¸°<br>â€¢ 5ë¶„ ì¼ì° ì¶œë°œ<br>â€¢ ì§€í•˜ í†µë¡œ ì´ìš©', false, true, [
                        { text: 'ğŸŒ‚ ìš°ì‚° ì±™ê¸°ê¸° ì•Œë¦¼', action: 'setUmbrellaReminder()', primary: false },
                        { text: 'â° ì¼ì° ì¶œë°œ ì„¤ì •', action: 'setEarlyDeparture()', primary: false }
                    ]);
                }, 2000);
            }, 1500);
        }

        // í‡´ê·¼ ì•Œë¦¼
        function sendEveningAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('ğŸŒ† í‡´ê·¼ ì‹œê°„ì´ì—ìš”!<br><br>ì˜¤ëŠ˜ í•˜ë£¨ ìˆ˜ê³ í•˜ì…¨ì–´ìš”.<br><br>ì§‘ê¹Œì§€ ì•½ 40ë¶„ ì˜ˆìƒë©ë‹ˆë‹¤.', false, false, [], false);
                
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2í˜¸ì„  + ë„ë³´',
                            description: 'íšŒì‚¬ â†’ ì§‘',
                            time: '40ë¶„',
                            status: 'ì•½ê°„ í˜¼ì¡',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        }
                    ];
                    addRouteCard(routes, "í‡´ê·¼ ê²½ë¡œ");
                }, 1000);
            }, 1500);
        }

        // ì¹´ì¹´ì˜¤ë§µ ì—´ê¸°
        function openKakaoMap() {
            window.open('https://map.kakao.com/', '_blank');
        }

        function startNavigation() {
            openKakaoMap();
        }

        // ê¸°íƒ€ í•¨ìˆ˜ë“¤
        function useAlternativeRoute() {
            addMessage('ëŒ€ì•ˆ ê²½ë¡œë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤', true);
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('âœ… 3í˜¸ì„  í™˜ìŠ¹ ê²½ë¡œë¡œ ì•ˆë‚´ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤!<br><br>ì˜ˆìƒ ì†Œìš” ì‹œê°„: 35ë¶„');
            }, 1000);
        }

        function setUmbrellaReminder() {
            addMessage('ìš°ì‚° ì±™ê¸°ê¸° ì•Œë¦¼ ì„¤ì •', true);
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('ğŸŒ‚ ìš°ì‚° ì±™ê¸°ê¸° ì•Œë¦¼ì´ ì„¤ì •ë˜ì—ˆì–´ìš”!<br><br>ì¶œë°œ 5ë¶„ ì „ì— ë‹¤ì‹œ ì•Œë ¤ë“œë¦´ê²Œìš”.');
            }, 1000);
        }

        function setEarlyDeparture() {
            addMessage('ì¼ì° ì¶œë°œ ì„¤ì •', true);
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('â° 5ë¶„ ì¼ì° ì¶œë°œí•˜ë„ë¡ ì„¤ì •ë˜ì—ˆì–´ìš”!<br><br>ìƒˆë¡œìš´ ì¶œë°œ ì‹œê°„: 08:10');
            }, 1000);
        }

        function checkCurrentRoute() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('í˜„ì¬ ê²½ë¡œë¥¼ í™•ì¸í•´ë“œë¦´ê²Œìš”!', false);
                setTimeout(() => {
                    const routes = [
                        {
                            name: '2í˜¸ì„  + ë„ë³´',
                            description: 'ê°•ë‚¨ì—­ â†’ íšŒì‚¬',
                            time: '42ë¶„',
                            status: 'ì›í™œ',
                            color: 'bg-blue-500',
                            icon: '2',
                            recommended: true
                        }
                    ];
                    addRouteCard(routes);
                }, 1000);
            }, 1000);
        }

        function showNotificationSettings() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('ì•Œë¦¼ ì„¤ì •ì„ í™•ì¸í•´ë³´ì„¸ìš”!', false, true, [
                    { text: 'ğŸŒ… ëª¨ë‹ ë¸Œë¦¬í•‘ ON/OFF', action: 'toggleMorningBriefing()', primary: false },
                    { text: 'ğŸš€ ì¶œë°œ ì•Œë¦¼ ON/OFF', action: 'toggleDepartureAlert()', primary: false },
                    { text: 'ğŸŒ§ï¸ ë‚ ì”¨ ì•Œë¦¼ ON/OFF', action: 'toggleWeatherAlert()', primary: false }
                ]);
            }, 1000);
        }

        function toggleMorningBriefing() {
            addMessage('ëª¨ë‹ ë¸Œë¦¬í•‘ ì„¤ì • ë³€ê²½', true);
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('âœ… ëª¨ë‹ ë¸Œë¦¬í•‘ì´ í™œì„±í™”ë˜ì—ˆì–´ìš”!<br><br>ë§¤ì¼ ì•„ì¹¨ 6:50ì— ì•Œë ¤ë“œë¦´ê²Œìš”.');
            }, 1000);
        }

        function toggleDepartureAlert() {
            addMessage('ì¶œë°œ ì•Œë¦¼ ì„¤ì • ë³€ê²½', true);
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('âœ… ì¶œë°œ ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆì–´ìš”!<br><br>ì¶œë°œ ì‹œê°„ì— ë§ì¶° ì•Œë ¤ë“œë¦´ê²Œìš”.');
            }, 1000);
        }

        function toggleWeatherAlert() {
            addMessage('ë‚ ì”¨ ì•Œë¦¼ ì„¤ì • ë³€ê²½', true);
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('âœ… ë‚ ì”¨ ì•Œë¦¼ì´ í™œì„±í™”ë˜ì—ˆì–´ìš”!<br><br>ë¹„ë‚˜ ëˆˆì´ ì˜¬ ë•Œ ë¯¸ë¦¬ ì•Œë ¤ë“œë¦´ê²Œìš”.');
            }, 1000);
        }

        function goBack() {
            window.location.href = 'new_final_integrated.html';
        }

        // ì´ˆê¸° ë©”ì‹œì§€
        setTimeout(() => {
            addMessage('ì•ˆë…•í•˜ì„¸ìš”! ìŠ¤ë§ˆíŠ¸ ì¶œí‡´ê·¼ ê´€ë¦¬ ì„œë¹„ìŠ¤ì— ì˜¤ì‹  ê±¸ í™˜ì˜í•´ìš”! ğŸ˜Š<br><br>"ì¶œí‡´ê·¼ ì•Œë ¤ì¤˜"ë¼ê³  ë§ì”€í•´ì£¼ì‹œë©´ ì‹œì‘í• ê²Œìš”!');
        }, 1000);
    </script>
</body>
</html>