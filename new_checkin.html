<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïπ¥Î∞ç - ÏïΩÏÜç D-Day</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'kakao-yellow': '#fef01b',
                        'kakao-bg': '#9bbbd4',
                        'kakao-text': '#556677',
                        'kakao-chat-bg': '#b2c7da'
                    },
                    fontFamily: {
                        'kakao': ['Apple SD Gothic Neo', 'Malgun Gothic', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background: linear-gradient(to bottom, #b2c7da, #9bbbd4);
        }

        .message-bubble {
            max-width: 75%;
            word-wrap: break-word;
            animation: slideIn 0.3s ease-out;
            font-size: 14px;
        }

        .message-other {
            background: white;
            border-radius: 18px 18px 18px 4px;
        }

        .message-user {
            background: #fef01b;
            border-radius: 18px 18px 4px 18px;
            margin-left: auto;
        }

        .status-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #e0e0e0;
            margin: 8px 0;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .location-card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            margin: 4px 0;
            padding: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .review-card {
            background: white;
            border-radius: 16px;
            border: 1px solid #e0e0e0;
            margin: 8px 0;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .typing-indicator {
            animation: pulse 1.5s infinite;
        }

        .time-notification {
            background: white;
            border-radius: 20px;
            margin: 12px auto;
            max-width: 280px;
            padding: 12px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        .time-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .time-icon {
            width: 24px;
            height: 24px;
            background: #ff6b6b;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .time-text {
            color: #556677;
            font-size: 16px;
            font-weight: 600;
        }

        .notification-sound {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fef01b;
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            animation: notificationPop 0.5s ease-out;
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        @keyframes notificationPop {
            0% {
                transform: translateY(-20px) scale(0.8);
                opacity: 0;
            }

            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .button-action {
            background: #ffffff;
            color: #556677;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            padding: 12px 20px;
            margin: 8px auto;
            display: block;
            cursor: pointer;
            transition: all 0.2s ease-out;
            font-size: 14px;
            font-weight: 600;
            width: fit-content;
            min-width: 120px;
            text-align: center;
        }

        .button-action:hover {
            background: #f9fafb;
            transform: scale(0.98);
        }

        .button-primary {
            background: #fef01b;
            color: #556677;
            border: 1px solid #e6d600;
            box-shadow: 0 4px 12px rgba(254, 240, 27, 0.4);
        }

        .button-primary:hover {
            background: #e6d600;
            box-shadow: 0 6px 16px rgba(254, 240, 27, 0.5);
        }

        .button-small {
            padding: 8px 16px;
            font-size: 12px;
            min-width: 80px;
        }

        .tag {
            display: inline-block;
            background: #f3f4f6;
            color: #556677;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tag:hover {
            background: #e5e7eb;
        }

        .tag-selected {
            background: #fef01b;
            color: #556677;
        }

        .progress-bar {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s ease;
        }

        .fab {
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: linear-gradient(135deg, #fef01b 0%, #f9e71e 50%, #f4d03f 100%);
            border-radius: 30px;
            display: flex;
            align-items: center;
            padding: 14px 20px;
            box-shadow: 0 6px 20px rgba(254, 240, 27, 0.4), 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            opacity: 0;
            transform: scale(0);
            max-width: 220px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .fab.show {
            opacity: 1;
            transform: scale(1);
        }

        .fab:hover {
            background: linear-gradient(135deg, #e6d600 0%, #dcc71a 50%, #d4b836 100%);
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(254, 240, 27, 0.5), 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .fab-icon {
            font-size: 22px;
            color: #556677;
            margin-right: 12px;
            flex-shrink: 0;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .fab-text {
            font-size: 14px;
            font-weight: 700;
            color: #556677;
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.3);
            letter-spacing: -0.3px;
        }
    </style>
</head>

<body class="min-h-screen">
    <!-- ÏïåÎ¶º ÏÇ¨Ïö¥Îìú ÌëúÏãú -->
    <div id="notification-sound" class="notification-sound hidden">
        üîî Ïπ¥Î∞ç ÏïåÎ¶º
    </div>

    <!-- ÌîåÎ°úÌåÖ Ïï°ÏÖò Î≤ÑÌäº (FAB) -->
    <div id="fab" class="fab" onclick="showTimeSimulator()">
        <span class="fab-icon">‚è∞</span>
        <span class="fab-text">Îã§Ïùå ÏãúÎÇòÎ¶¨Ïò§ Ï≤¥Ìóò</span>
    </div>

    <!-- ÏãúÍ∞Ñ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ Î™®Îã¨ -->
    <div id="time-simulator" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div
            class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 w-80">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ÏïΩÏÜç D-Day ÏãúÎÇòÎ¶¨Ïò§</h3>
            <div class="space-y-3">
                <button onclick="simulateTime('15:00', 't3h')"
                    class="w-full bg-blue-100 text-blue-800 py-3 px-4 rounded-xl font-medium hover:bg-blue-200 transition-colors">
                    üïí T-3H - ÌòÑÏû¨ ÏÉÅÌô© Ï≤¥ÌÅ¨
                </button>
                <button onclick="simulateTime('17:30', 't30m')"
                    class="w-full bg-green-100 text-green-800 py-3 px-4 rounded-xl font-medium hover:bg-green-200 transition-colors">
                    üìç T-30M - Ïã§ÏãúÍ∞Ñ ÏúÑÏπò ÌôïÏù∏
                </button>
                <button onclick="simulateTime('17:25', 'departure')"
                    class="w-full bg-orange-100 text-orange-800 py-3 px-4 rounded-xl font-medium hover:bg-orange-200 transition-colors">
                    üöÄ Ï∂úÎ∞ú ÏïåÎ¶º
                </button>
                <button onclick="simulateTime('17:45', 'exception')"
                    class="w-full bg-red-100 text-red-800 py-3 px-4 rounded-xl font-medium hover:bg-red-200 transition-colors">
                    üö® ÏòàÏô∏ ÏÉÅÌô© - ÏßÄÏó∞ Î∞úÏÉù
                </button>
                <button onclick="simulateTime('20:30', 'review')"
                    class="w-full bg-purple-100 text-purple-800 py-3 px-4 rounded-xl font-medium hover:bg-purple-200 transition-colors">
                    ‚≠ê ÌõÑÍ∏∞ ÏûëÏÑ±
                </button>
            </div>
            <button onclick="closeTimeSimulator()"
                class="w-full mt-4 bg-gray-200 text-gray-700 py-2 px-4 rounded-xl font-medium hover:bg-gray-300 transition-colors">
                Îã´Í∏∞
            </button>
        </div>
    </div>

    <!-- Ïπ¥Ïπ¥Ïò§ÌÜ° Ìó§Îçî -->
    <div class="bg-kakao-yellow shadow-sm">
        <div class="max-w-md mx-auto px-4 py-3 flex items-center">
            <button onclick="goBack()" class="mr-3 text-gray-700">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
                </svg>
            </button>
            <div class="flex items-center space-x-3 flex-1">
                <div
                    class="w-10 h-10 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center">
                    <span class="text-white text-lg">ü§ñ</span>
                </div>
                <div>
                    <h1 class="font-semibold text-gray-800">Ïπ¥Î∞ç</h1>
                    <p class="text-xs text-gray-600" id="calming-status">ÏïΩÏÜç D-Day Í¥ÄÎ¶¨</p>
                </div>
            </div>
            <div class="flex space-x-2">
                <button onclick="showTimeSimulator()"
                    class="text-gray-700 text-xs bg-white bg-opacity-50 px-2 py-1 rounded">
                    ‚è∞ ÏãúÍ∞Ñ
                </button>
                <button class="text-gray-700">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z" />
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Ï±ÑÌåÖ ÏòÅÏó≠ -->
    <div class="max-w-md mx-auto bg-kakao-chat-bg min-h-screen">
        <div id="chat-container" class="p-4 space-y-3 pb-20">
            <!-- Î©îÏãúÏßÄÎì§Ïù¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
        </div>

        <!-- ÏûÖÎ†• ÏòÅÏó≠ -->
        <div class="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t p-3">
            <div class="flex items-center space-x-2">
                <button class="text-gray-500">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
                    </svg>
                </button>
                <input id="message-input" type="text" placeholder="Î©îÏãúÏßÄÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-full focus:outline-none focus:border-kakao-yellow"
                    onkeypress="handleKeyPress(event)">
                <button onclick="sendMessage()"
                    class="bg-kakao-yellow text-gray-800 px-4 py-2 rounded-full font-medium hover:bg-yellow-500 transition-colors">
                    Ï†ÑÏÜ°
                </button>
            </div>
        </div>
    </div>

    <script>
        let chatContainer = document.getElementById('chat-container');
        let messageInput = document.getElementById('message-input');

        // ÏïåÎ¶º ÏÇ¨Ïö¥Îìú ÌëúÏãú
        function showNotificationSound() {
            const soundDiv = document.getElementById('notification-sound');
            soundDiv.classList.remove('hidden');
            setTimeout(() => {
                soundDiv.classList.add('hidden');
            }, 2000);
        }

        // FAB ÌëúÏãú/Ïà®ÍπÄ Ï†úÏñ¥
        function showFAB() {
            const fab = document.getElementById('fab');
            fab.classList.add('show');
        }

        function hideFAB() {
            const fab = document.getElementById('fab');
            fab.classList.remove('show');
        }

        // Î©îÏãúÏßÄ Ï∂îÍ∞Ä Ìï®Ïàò
        function addMessage(content, isUser = false, hasButtons = false, buttons = [], isSystem = false) {
            const messageDiv = document.createElement('div');
            let className = `message-bubble p-3 mb-2`;

            if (isSystem) {
                className += ' message-system';
            } else if (isUser) {
                className += ' message-user ml-auto';
            } else {
                className += ' message-other';
            }

            messageDiv.className = className;

            let messageHTML = `<p class="text-sm ${isSystem ? 'text-blue-800 text-center' : 'text-gray-800'}">${content}</p>`;

            if (hasButtons && buttons.length > 0) {
                messageHTML += '<div class="mt-3 flex flex-col items-center space-y-2">';
                buttons.forEach(button => {
                    let buttonClass = 'button-action';
                    if (button.primary) buttonClass += ' button-primary';
                    if (button.small) buttonClass += ' button-small';

                    messageHTML += `<button onclick="${button.action}" class="${buttonClass}">${button.text}</button>`;
                });
                messageHTML += '</div>';
            }

            messageDiv.innerHTML = messageHTML;
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        // ÌòÑÏû¨ ÏÉÅÌô© Ï≤¥ÌÅ¨ Ïπ¥Îìú Ï∂îÍ∞Ä
        function addStatusCard() {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'status-card p-4 mb-2 max-w-xs';

            cardDiv.innerHTML = `
                <div class="flex items-center space-x-2 mb-3">
                    <span class="text-2xl">üìç</span>
                    <h4 class="font-semibold text-gray-800">ÌòÑÏû¨ ÏÉÅÌô© Ï≤¥ÌÅ¨</h4>
                </div>
                
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-2">
                            <span class="text-lg">üìç</span>
                            <span class="text-sm text-gray-700">ÌòÑÏû¨ ÏúÑÏπò</span>
                        </div>
                        <span class="text-sm font-medium text-gray-800">Ïßë (ÏòàÏÉÅÎåÄÎ°ú)</span>
                    </div>
                    
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-2">
                            <span class="text-lg">üöá</span>
                            <span class="text-sm text-gray-700">ÍµêÌÜµÏàòÎã®</span>
                        </div>
                        <span class="text-sm font-medium text-gray-800">ÎåÄÏ§ëÍµêÌÜµ (Î≥ÄÍ≤Ω Í∞ÄÎä•)</span>
                    </div>
                    
                    <div class="bg-green-50 p-3 rounded-lg border-l-4 border-green-400">
                        <div class="flex items-center space-x-2 mb-1">
                            <span class="text-lg">‚è∞</span>
                            <span class="text-sm font-semibold text-green-800">Í∂åÏû• Ï∂úÎ∞úÏãúÍ∞Ñ</span>
                        </div>
                        <div class="text-lg font-bold text-green-800">Ïò§ÌõÑ 6:25</div>
                        <div class="text-xs text-green-600 mt-1">35Î∂Ñ ÌõÑ</div>
                    </div>
                </div>
            `;

            chatContainer.appendChild(cardDiv);
            scrollToBottom();
        }

        // Ïã§ÏãúÍ∞Ñ ÏúÑÏπò Ïπ¥ÎìúÎì§ Ï∂îÍ∞Ä
        function addLocationCards() {
            const locations = [
                {
                    name: 'Îã®Î¨¥ÏßÄ',
                    avatar: 'Îã®',
                    color: 'bg-orange-400',
                    location: 'Í∞ïÎÇ®Ïó≠ Ïù∏Í∑º',
                    time: '30Î∂Ñ ÏÜåÏöî ÏòàÏ†ï',
                    status: 'on-time'
                },
                {
                    name: 'Ïó∞Ïñ¥ÌîºÏπò',
                    avatar: 'Ïó∞',
                    color: 'bg-pink-400',
                    location: 'ÏÑ†Î¶âÏó≠ Ïù∏Í∑º',
                    time: '1ÏãúÍ∞Ñ ÏÜåÏöî ÏòàÏ†ï',
                    status: 'delayed'
                },
                {
                    name: 'ÏΩòÏπòÏ¶à',
                    avatar: 'ÏΩò',
                    color: 'bg-blue-400',
                    location: 'ÎèÑÏ∞© ÏôÑÎ£å',
                    time: 'Ïä§Ïãú Ï†† ÎåÄÍ∏∞ Ï§ë',
                    status: 'arrived'
                }
            ];

            locations.forEach(person => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'location-card';

                const statusColor = person.status === 'arrived' ? 'text-green-600' :
                    person.status === 'delayed' ? 'text-red-600' : 'text-blue-600';

                const statusIcon = person.status === 'arrived' ? '‚úÖ' :
                    person.status === 'delayed' ? '‚ö†Ô∏è' : 'üöá';

                cardDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 ${person.color} rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${person.avatar}
                            </div>
                            <div>
                                <div class="font-medium text-gray-800">${person.name}</div>
                                <div class="text-sm text-gray-600">${person.location}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="flex items-center space-x-1">
                                <span class="text-sm">${statusIcon}</span>
                                <span class="text-sm ${statusColor} font-medium">${person.time}</span>
                            </div>
                        </div>
                    </div>
                `;

                chatContainer.appendChild(cardDiv);
            });
            scrollToBottom();
        }

        // ÎåÄÏïà Í≤ΩÎ°ú Ïπ¥Îìú Ï∂îÍ∞Ä (ÏßÄÏó∞ Î∞úÏÉù Ïãú)
        function addAlternativeRouteCard(routes) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'status-card p-4 mb-2 max-w-xs';

            let cardHTML = `<h4 class="font-semibold text-gray-800 mb-3">üîÑ ÎåÄÏïà Í≤ΩÎ°ú</h4>`;

            routes.forEach((route, index) => {
                const statusColor = route.status === 'ÏõêÌôú' ? 'text-green-600' :
                    route.status === 'ÏßÄÏó∞' ? 'text-red-600' : 'text-orange-600';

                cardHTML += `
                    <div class="p-3 ${index > 0 ? 'border-t border-gray-100' : ''} ${route.recommended ? 'bg-yellow-50 rounded-lg' : ''}">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center space-x-3">
                                <div class="w-8 h-8 ${route.color} rounded-full flex items-center justify-center">
                                    <span class="text-white text-xs font-bold">${route.icon}</span>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-800 text-sm">${route.name}</p>
                                    <p class="text-xs text-gray-600">${route.description}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-semibold text-gray-800">${route.time}</div>
                                <div class="text-xs ${statusColor}">${route.status}</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div class="text-xs text-gray-600">
                                ÏöîÍ∏à: <span class="font-semibold">${route.cost}</span>
                            </div>
                            <button onclick="${route.action}" class="bg-kakao-yellow text-gray-800 px-3 py-1 rounded-lg text-xs font-medium hover:bg-yellow-500 transition-colors">
                                ÏÑ†ÌÉù
                            </button>
                        </div>
                    </div>
                `;
            });

            cardDiv.innerHTML = cardHTML;
            chatContainer.appendChild(cardDiv);
            scrollToBottom();
        }

        // Î¶¨Î∑∞ ÌÉúÍ∑∏ Ïπ¥Îìú Ï∂îÍ∞Ä
        function addReviewTagCard() {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'review-card p-4 mb-2 max-w-xs';

            cardDiv.innerHTML = `
                <h4 class="font-semibold text-gray-800 mb-3">üè∑Ô∏è Î¶¨Î∑∞ ÌÉúÍ∑∏ ÏûêÎèô ÏÉùÏÑ±</h4>
                <p class="text-sm text-gray-600 mb-3">ÌõÑÍ∏∞Î•º Î∂ÑÏÑùÌï¥ÏÑú ÌÉúÍ∑∏Î•º ÏûêÎèôÏúºÎ°ú ÎßåÎì§ÏóàÏñ¥Ïöî!</p>
                
                <div class="space-y-2 mb-4">
                    <div class="text-xs text-gray-500 mb-1">Ï∂îÏ≤ú ÌÉúÍ∑∏:</div>
                    <div class="flex flex-wrap gap-1">
                        <span class="tag tag-selected" onclick="toggleTag(this)">#ÎßõÏßëÏ∂îÏ≤ú</span>
                        <span class="tag tag-selected" onclick="toggleTag(this)">#Ï°∞Ïö©ÌïúÎ∂ÑÏúÑÍ∏∞</span>
                        <span class="tag tag-selected" onclick="toggleTag(this)">#ÎåÄÌôîÌïòÍ∏∞Ï¢ãÏùÄÍ≥≥</span>
                        <span class="tag" onclick="toggleTag(this)">#ÏùºÎ≥∏Ïó¨ÌñâÎäêÎÇå</span>
                        <span class="tag" onclick="toggleTag(this)">#Ï†ÑÎ¨∏Í∞ÄÏÜúÏî®</span>
                        <span class="tag" onclick="toggleTag(this)">#Ï¥àÎ∞•ÎßõÏßë</span>
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="confirmReviewTags()" class="button-action button-primary flex-1 button-small">ÌôïÏù∏</button>
                    <button onclick="editReviewTags()" class="button-action flex-1 button-small">ÏàòÏ†ï</button>
                </div>
            `;

            chatContainer.appendChild(cardDiv);
            scrollToBottom();
        }

        // ÌÉÄÏù¥Ìïë Ïù∏ÎîîÏºÄÏù¥ÌÑ∞
        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.className = 'message-bubble message-other p-3 mb-2 typing-indicator';
            typingDiv.innerHTML = '<p class="text-sm text-gray-600">Ïπ¥Î∞çÏù¥ ÏûÖÎ†• Ï§ë...</p>';
            chatContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideTyping() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        // Ïä§ÌÅ¨Î°§ ÌïòÎã®ÏúºÎ°ú
        function scrollToBottom() {
            setTimeout(() => {
                window.scrollTo(0, document.body.scrollHeight);
            }, 100);
        }

        // ÌÇ§ ÏûÖÎ†• Ï≤òÎ¶¨
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Î©îÏãúÏßÄ Ï†ÑÏÜ°
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            messageInput.value = '';
        }

        // ÏãúÍ∞Ñ ÏãúÎÆ¨Î†àÏù¥ÌÑ∞ ÌëúÏãú/Ïà®ÍπÄ
        function showTimeSimulator() {
            document.getElementById('time-simulator').classList.remove('hidden');
            hideFAB();
        }

        function closeTimeSimulator() {
            document.getElementById('time-simulator').classList.add('hidden');
        }

        // ÏãúÍ∞Ñ ÏïåÎ¶º Ïπ¥Îìú Ï∂îÍ∞Ä
        function addTimeNotification(time) {
            const timeDiv = document.createElement('div');
            timeDiv.className = 'time-notification';

            timeDiv.innerHTML = `
                <div class="time-display">
                    <div class="time-icon">‚è∞</div>
                    <div class="time-text">ÏãúÍ∞Ñ: ${time}</div>
                </div>
            `;

            chatContainer.appendChild(timeDiv);
            scrollToBottom();
        }

        // ÏãúÍ∞ÑÎ≥Ñ ÏãúÎÇòÎ¶¨Ïò§ ÏãúÎÆ¨Î†àÏù¥ÏÖò
        function simulateTime(time, type) {
            closeTimeSimulator();
            showNotificationSound();

            addTimeNotification(time);

            setTimeout(() => {
                if (type === 't3h') {
                    sendT3HAlert();
                } else if (type === 't30m') {
                    sendT30MAlert();
                } else if (type === 'exception') {
                    sendExceptionAlert();
                } else if (type === 'departure') {
                    sendDepartureAlert();
                } else if (type === 'review') {
                    sendReviewRequest();
                }
            }, 1000);
        }

        // T-3H ÏïåÎ¶º
        function sendT3HAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('üïí <strong>T-3H ÌòÑÏû¨ ÏÉÅÌô© Ï≤¥ÌÅ¨</strong><br><br>ÏïΩÏÜç 3ÏãúÍ∞Ñ Ï†ÑÏù¥ÏóêÏöî! ÌòÑÏû¨ ÍµêÌÜµ ÏÉÅÌô©ÏùÑ ÌôïÏù∏Ìï¥ÎìúÎ¶¥Í≤åÏöî.');

                setTimeout(() => {
                    addStatusCard();

                    setTimeout(() => {
                        showTyping();
                        setTimeout(() => {
                            hideTyping();
                            addMessage('ÏΩòÏπòÏ¶àÎãòÏùò ÏµúÍ∑º Ìå®ÌÑ¥ÏùÑ Ï∞∏Í≥†Ìï¥Î≥º Îïå 2Ìò∏ÏÑ†Ïù¥ Îçú ÌòºÏû°Ìï† Í≤É Í∞ôÏïÑÏöî. ÌòÑÏû¨ ÏÇ¨Îûå ÎßéÏùÄ Ïã†Î∂ÑÎãπÏÑ†Î≥¥Îã§Îäî 2Ìò∏ÏÑ† ÌÉÄÍ∏∞Î•º Ï∂îÏ≤úÎìúÎ¶ΩÎãàÎã§.<br><br>Í∂åÏû• Ï∂úÎ∞ú ÏãúÍ∞ÑÏùÄ <strong>Ïò§ÌõÑ 6:25</strong>ÏûÖÎãàÎã§.');

                            setTimeout(() => {
                                showFAB();
                            }, 2000);
                        }, 2000);
                    }, 1000);
                }, 1000);
            }, 2000);
        }

        // T-30M ÏïåÎ¶º
        function sendT30MAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('üìç <strong>T-30M Ïã§ÏãúÍ∞Ñ ÏúÑÏπò ÌôïÏù∏</strong><br><br>Ïπ¥Ïπ¥Ïò§ÎßµÏùÑ Ïó¥Ïñ¥, ÏπúÍµ¨Îì§Ïùò Ïã§ÏãúÍ∞Ñ ÏúÑÏπòÎ•º ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî!', false, true, [
                    { text: 'üó∫Ô∏è Ïπ¥Ïπ¥Ïò§Îßµ Ïó¥Í∏∞', action: 'openKakaoMap()', primary: false, small: true }
                ]);

                setTimeout(() => {
                    addLocationCards();

                    setTimeout(() => {
                        showFAB();
                    }, 2000);
                }, 1000);
            }, 2000);
        }

        // ÏòàÏô∏ ÏÉÅÌô© ÏïåÎ¶º
        function sendExceptionAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('üö® <strong>ÏòàÏô∏ ÏÉÅÌô© Î∞úÏÉù!</strong><br><br>2Ìò∏ÏÑ†Ïóê ÏßÄÏó∞Ïù¥ Î∞úÏÉùÌñàÏñ¥Ïöî. ÏïΩÏÜç Ïû•ÏÜåÍπåÏßÄ Îä¶ÏùÑ Ïàò ÏûàÏäµÎãàÎã§.<br><br>ÎåÄÏïà Í≤ΩÎ°úÎ•º Ï∂îÏ≤úÌï¥ÎìúÎ¶¥Í≤åÏöî!', false, false, [], false);

                setTimeout(() => {
                    addMessage('üîÑ ÎåÄÏïà Í≤ΩÎ°úÎ•º ÌôïÏù∏Ìï¥Î≥¥ÏÑ∏Ïöî:');

                    setTimeout(() => {
                        const alternativeRoutes = [
                            {
                                name: '3Ìò∏ÏÑ† ÌôòÏäπ',
                                description: '3Ìò∏ÏÑ† ‚Üí 2Ìò∏ÏÑ† ÌôòÏäπ',
                                time: '30Î∂Ñ',
                                cost: '1,370Ïõê',
                                status: 'ÏõêÌôú',
                                color: 'bg-orange-500',
                                icon: '3',
                                recommended: true,
                                action: "selectAlternativeRoute('3Ìò∏ÏÑ† ÌôòÏäπ')"
                            },
                            {
                                name: 'Î≤ÑÏä§ 740Î≤à',
                                description: 'Ïßë ‚Üí ÏïΩÏÜçÏû•ÏÜå ÏßÅÌñâ',
                                time: '35Î∂Ñ',
                                cost: '1,200Ïõê',
                                status: 'ÏïΩÍ∞Ñ ÌòºÏû°',
                                color: 'bg-green-500',
                                icon: 'üöå',
                                recommended: false,
                                action: "selectAlternativeRoute('Î≤ÑÏä§ 740Î≤à')"
                            },
                            {
                                name: 'ÌÉùÏãú',
                                description: 'Ïßë ‚Üí ÏïΩÏÜçÏû•ÏÜå ÏßÅÌñâ',
                                time: '20Î∂Ñ',
                                cost: '10,000Ïõê',
                                status: 'ÏõêÌôú',
                                color: 'bg-yellow-500',
                                icon: 'üöï',
                                recommended: false,
                                action: "selectAlternativeRoute('ÌÉùÏãú')"
                            }
                        ];
                        addAlternativeRouteCard(alternativeRoutes);
                    }, 1000);
                }, 2000);
            }, 2000);
        }

        // Ï∂úÎ∞ú ÏïåÎ¶º
        function sendDepartureAlert() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('üöÄ <strong>Ï∂úÎ∞ú ÏãúÍ∞ÑÏûÖÎãàÎã§!</strong><br><br>ÏßÄÍ∏à Î∞îÎ°ú Ï∂úÎ∞úÌïòÏÑ∏Ïöî! ÏπúÍµ¨Îì§Ïù¥ Í∏∞Îã§Î¶¨Í≥† ÏûàÏñ¥Ïöî üòä', false, true, [
                    { text: 'üó∫Ô∏è Í∏∏Ï∞æÍ∏∞ ÏãúÏûë', action: 'startNavigation()', primary: true, small: true }
                ]);

                setTimeout(() => {
                    showFAB();
                }, 2000);
            }, 1500);
        }

        // ÌõÑÍ∏∞ ÏöîÏ≤≠
        function sendReviewRequest() {
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('Îã®Î¨¥ÏßÄÎãòÏù¥ Ï∂îÏ≤úÌïú Ï¥àÎ∞•Ïßë, Îã§Îì§ ÎßåÏ°±ÌïòÏÖ®ÎÇòÏöî? "Ï°∞Ïö©Ìïú Í≥≥"Ïù¥Îùº ÎåÄÌôîÌïòÍ∏∞ Ï¢ãÏúºÏÖ®ÎäîÏßÄ Í∂ÅÍ∏àÌï¥Ïöî!');

                // ÏÇ¨Ïö©Ïûê ÏùëÎãµ ÏãúÎÆ¨Î†àÏù¥ÏÖò
                setTimeout(() => {
                    addMessage('Ï°∞Ïö©ÌïòÍ≥† Ï¢ãÏïòÏñ¥. Í∑∏Î¶¨Í≥† Ï¥àÎ∞•Ïóê Î∞•Ïïå Í∞ØÏàòÍ∞Ä Ï†ïÌôïÌûà 320Í∞úÏòÄÏñ¥. Ï†ÑÎ¨∏Í∞Ä ÏÜúÏî®ÎùºÏÑú ÏïÑÏ£º ÎßàÏùåÏóê Îì§ÏóàÏñ¥. Î∂ÑÏúÑÍ∏∞ÎèÑ Ï†ïÎßê Ï¢ãÏïòÏñ¥ ÏùºÎ≥∏ Ïó¨Ìñâ Ïò®Í±∞ Í∞ôÏïòÏñ¥.', true);

                    setTimeout(() => {
                        showTyping();
                        setTimeout(() => {
                            hideTyping();
                            addMessage('Í∞êÏÇ¨Ìï©ÎãàÎã§! ÌõÑÍ∏∞Î•º Î∂ÑÏÑùÌï¥ÏÑú ÌÉúÍ∑∏Î°ú ÏûêÎèô Î≥ÄÌôòÌïòÏó¨ Ïπ¥Ïπ¥Ïò§Îßµ Î¶¨Î∑∞Ïóê Î∞òÏòÅÌï¥ÎìúÎ¶¥Í≤åÏöî üè∑Ô∏è');

                            setTimeout(() => {
                                addReviewTagCard();

                                setTimeout(() => {
                                    showFAB();
                                }, 2000);
                            }, 1000);
                        }, 2000);
                    }, 1000);
                }, 2000);
            }, 2000);
        }

        // ÌÉúÍ∑∏ ÌÜ†Í∏Ä
        function toggleTag(element) {
            element.classList.toggle('tag-selected');
        }

        // Î¶¨Î∑∞ ÌÉúÍ∑∏ ÌôïÏù∏
        function confirmReviewTags() {
            addMessage('ÌôïÏù∏', true);

            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();
                    addMessage('‚úÖ Ïπ¥Ïπ¥Ïò§Îßµ Î¶¨Î∑∞Í∞Ä Îì±Î°ùÎêòÏóàÏñ¥Ïöî!<br><br>ÏÑ†ÌÉùÌïòÏã† ÌÉúÍ∑∏Îì§Ïù¥ Î∞òÏòÅÎêòÏñ¥ Îã§Î•∏ ÏÇ¨Ïö©ÏûêÎì§ÏóêÍ≤å ÎèÑÏõÄÏù¥ Îê† Í±∞ÏòàÏöî üòä');

                    setTimeout(() => {
                        showFAB();
                    }, 2000);
                }, 1500);
            }, 500);
        }

        // Î¶¨Î∑∞ ÌÉúÍ∑∏ ÏàòÏ†ï
        function editReviewTags() {
            addMessage('ÏàòÏ†ï', true);
            addMessage('ÌÉúÍ∑∏Î•º ÏßÅÏ†ë ÏÑ†ÌÉùÌï¥ÏÑú ÏàòÏ†ïÌï¥Î≥¥ÏÑ∏Ïöî! ÌÅ¥Î¶≠ÌïòÎ©¥ ÏÑ†ÌÉù/Ìï¥Ï†úÎê©ÎãàÎã§.');
        }

        // ÎåÄÏïà Í≤ΩÎ°ú ÏÑ†ÌÉù
        function selectAlternativeRoute(routeName) {
            addMessage(routeName, true);

            setTimeout(() => {
                showTyping();
                setTimeout(() => {
                    hideTyping();

                    if (routeName === '3Ìò∏ÏÑ† ÌôòÏäπ') {
                        addMessage('üöá 3Ìò∏ÏÑ† ÌôòÏäπ Í≤ΩÎ°ú:<br><br>‚Ä¢ ÏÜåÏöî ÏãúÍ∞Ñ: 30Î∂Ñ<br>‚Ä¢ 3Ìò∏ÏÑ† ‚Üí 2Ìò∏ÏÑ† ÌôòÏäπ<br>‚Ä¢ ÏöîÍ∏à: 1,370Ïõê<br><br>‚úÖ Í≤ΩÎ°ú ÏïàÎÇ¥Î•º ÏãúÏûëÌï©ÎãàÎã§!', false, true, [
                            { text: 'üó∫Ô∏è Ïπ¥Ïπ¥Ïò§ÎßµÏóêÏÑú Î≥¥Í∏∞', action: 'openKakaoMap()', primary: true, small: true }
                        ]);
                    } else if (routeName === 'Î≤ÑÏä§ 740Î≤à') {
                        addMessage('üöå Î≤ÑÏä§ 740Î≤à Í≤ΩÎ°ú:<br><br>‚Ä¢ ÏÜåÏöî ÏãúÍ∞Ñ: 35Î∂Ñ<br>‚Ä¢ Ïßë ‚Üí ÏïΩÏÜçÏû•ÏÜå ÏßÅÌñâ<br>‚Ä¢ ÏöîÍ∏à: 1,200Ïõê<br><br>‚úÖ Í≤ΩÎ°ú ÏïàÎÇ¥Î•º ÏãúÏûëÌï©ÎãàÎã§!', false, true, [
                            { text: 'üó∫Ô∏è Ïπ¥Ïπ¥Ïò§ÎßµÏóêÏÑú Î≥¥Í∏∞', action: 'openKakaoMap()', primary: true, small: true }
                        ]);
                    } else if (routeName === 'ÌÉùÏãú') {
                        addMessage('üöï ÌÉùÏãú Ïù¥Ïö©:<br><br>‚Ä¢ ÏÜåÏöî ÏãúÍ∞Ñ: 20Î∂Ñ<br>‚Ä¢ Ïßë ‚Üí ÏïΩÏÜçÏû•ÏÜå ÏßÅÌñâ<br>‚Ä¢ ÏòàÏÉÅ ÏöîÍ∏à: 10,000Ïõê<br><br>‚úÖ ÌÉùÏãú Ìò∏Ï∂úÏùÑ ÎèÑÏôÄÎìúÎ¶¥ÍπåÏöî?', false, true, [
                            { text: 'üöï Ïπ¥Ïπ¥Ïò§T Ìò∏Ï∂ú', action: 'callKakaoTaxi()', primary: true, small: true },
                            { text: 'üó∫Ô∏è Ïπ¥Ïπ¥Ïò§ÎßµÏóêÏÑú Î≥¥Í∏∞', action: 'openKakaoMap()', primary: false, small: true }
                        ]);
                    }

                    // ÏïåÎ¶º ÏôÑÎ£å ÌõÑ FAB ÌëúÏãú
                    setTimeout(() => {
                        showFAB();
                    }, 2000);
                }, 1500);
            }, 500);
        }

        // Ïπ¥Ïπ¥Ïò§T Ìò∏Ï∂ú
        function callKakaoTaxi() {
            addMessage('Ïπ¥Ïπ¥Ïò§T Ìò∏Ï∂ú', true);
            showTyping();
            setTimeout(() => {
                hideTyping();
                addMessage('üöï Ïπ¥Ïπ¥Ïò§T Ïï±ÏúºÎ°ú Ïó∞Í≤∞Ìï©ÎãàÎã§!<br><br>ÌÉùÏãú Ìò∏Ï∂úÏù¥ ÏôÑÎ£åÎêòÎ©¥ Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏúÑÏπòÎ•º ÏïåÎ†§ÎìúÎ¶¥Í≤åÏöî.');
            }, 1000);
        }

        // Í∏∞ÌÉÄ Ìï®ÏàòÎì§
        function showAlternativeRoute() {
            addMessage('ÎåÄÏïà Í≤ΩÎ°ú Î≥¥Í∏∞', true);
            addMessage('üöá 3Ìò∏ÏÑ† ÌôòÏäπ Í≤ΩÎ°ú: 35Î∂Ñ<br>üöå Î≤ÑÏä§ 740Î≤à: 40Î∂Ñ<br>üöï ÌÉùÏãú: 25Î∂Ñ (12,000Ïõê)');
        }

        function callTaxi() {
            addMessage('ÌÉùÏãú Ìò∏Ï∂ú', true);
            addMessage('üöï ÌÉùÏãúÍ∞Ä Ìò∏Ï∂úÎêòÏóàÏñ¥Ïöî! 5Î∂Ñ ÌõÑ ÎèÑÏ∞© ÏòàÏ†ïÏûÖÎãàÎã§.');
        }

        function startNavigation() {
            addMessage('Í∏∏Ï∞æÍ∏∞ ÏãúÏûë', true);
            openKakaoMap();
        }

        function openKakaoMap() {
            window.open('https://map.kakao.com/', '_blank');
        }

        function goBack() {
            window.location.href = 'index.html';
        }

        // Ï¥àÍ∏∞ Î©îÏãúÏßÄ
        setTimeout(() => {
            addMessage('ÏïàÎÖïÌïòÏÑ∏Ïöî! Ïò§ÎäòÏùÄ ÏïΩÏÜç D-DayÏòàÏöî! üéâ<br><br>ÏÉÅÎã®Ïùò ‚è∞ ÏãúÍ∞Ñ Î≤ÑÌäºÏùÑ ÎàåÎü¨ÏÑú Îã§ÏñëÌïú ÏãúÍ∞ÑÎåÄÏùò ÏïåÎ¶ºÏùÑ Ï≤¥ÌóòÌï¥Î≥¥ÏÑ∏Ïöî!', false, true, [
                { text: '‚è∞ ÏãúÎÇòÎ¶¨Ïò§ Ï≤¥ÌóòÌïòÍ∏∞', action: 'showTimeSimulator()', primary: true }
            ]);
        }, 1000);
    </script>
</body>

</html>
